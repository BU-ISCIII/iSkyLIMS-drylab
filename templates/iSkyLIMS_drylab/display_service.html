{% extends 'iSkyLIMS_drylab/base.html' %}
{% load static %}

{% block content %}
{% if display_service %}
{% load mptt_tags %}
{% load l10n %}
    <h1><div class="color-heading">Service Information for the service {{ display_service.service_name}}</div></h1>
    <div class="row row-space-2 margin-b-4">
        <div class="col-sm-6">  <!-- general information from service -->
            <div class="panel panel-default">
                <div class="panel-heading"><h3>Service requested information</h3></div>
                <div class="panel-body">
                    <table class="table table-hover">
                        <tbody>
                            {% if display_service.resolution_folder %}
                                <tr>
                                   <td>Folder Name </td>
                                   <td>{{ display_service.resolution_folder }} </td>
                                </tr>
                            {% endif %}
                            <tr>
                                <td>Service Requested by:  </td>
                                <td> {{ display_service.user_name }} </td>
                            </tr>
                            <tr>
                                <td>Service is in State:  </td>
                                <td> {{ display_service.state }} </td>
                            </tr>

                            <tr>
                                <td>File uploaded for the service:  </td>
                                {% if display_service.file %}
                                    <td><a href="{{ display_service.file }}" download> File used  <span class="glyphicon glyphicon-download-alt"></span></a></td>
                                {% else %}
                                    <td>No file uploaded</td>
                                {% endif %}
                            </tr>

                            {% for text, value in display_service.service_dates %}
                                <tr>
                                    <td>{{ text }}</td>
                                    <td>{{ value }}</td>
                                </tr>
                            {% endfor%}
                            <tr>
                                <td>Estimated Delivery date </td>
                                <td>{{ display_service.estimated_delivery_date }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div> <!--// end panel body -->
            </div> <!--// end panel -->
        </div> <!--// end col-sm-6  general information from service  -->
        <div class="col-sm-5 col-sm-offset-1 ">  <!-- Actions  allowed-->
            <div class="panel panel-default">
                <div class="panel-heading"><h3>Allowed actions on {{ display_service.service_name}}</div></h3>
                <div class="panel-body">
                    <h5>Click on the following buttons to update the service</h5>
                    {% if display_service.add_resolution_action %}
                        <form class="" action="/drylab/addResolution" method="post">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="formToaddResolutionService">
                            <input type="hidden" name="service_id" value="{{display_service.service_id}}">
                            {% if display_service.multiple_services %}
                                {% if display_service.first_resolution %}
                                    <p>Select the Service/Services for which you want to do the new resolution OR select None or all to handle all in the new resolution</p>
                                    <input type="hidden" name="children_services_id" value="{% for id, name in display_service.children_services %}{{id}},{% endfor %}">

                                    <div class="form-group">
                                        <label class="col-sm-5 control-label" for="childrenServices" >Select services</label>
                                        <div class="col-sm-7">
                                           <select class="custom-select" name="childrenServices"  id="childrenServices" multiple>
                                               {% for id, name in display_service.children_services %}
                                                   <option value="{{id}}">{{name}}</option>
                                               {% endfor %}
                                           </select>
                                        </div>
                                    </div>  <!-- end from-group   -->
                                {% else %}
                                    <p>vacio</p>
                                {% endif %}
                            {% endif %}

                            <div class="col-sm-4 ">  <!-- col-sm-4  resolution button  -->
                                <br><br>
                                <input class="btn pull-right btn-primary" type="submit" id ="btnSubmit" value="Add Resolution">
                            </div> <!--// end col-sm-4   resolution button  -->
                        </form>
                    {% endif%}
                    {% if display_service.add_in_progress_action %}
                        <div class="col-sm-3 col-sm-offset-1">  <!-- col-sm-4  in Progress  button  -->
                             <a href="/drylab/addinProgress={{ display_service.add_in_progress_action }}" class="btn btn-primary" role="button">In Progress</a>
                        </div> <!--// end col-sm-4   in Progress button  -->
                    {% endif%}
                    {% if display_service.add_delivery_action %}
                        <div class="col-sm-3 col-sm-offset-1">  <!-- col-sm-3  delivery button  -->
                            <a href="/drylab/addDelivery={{ display_service.add_delivery_action }}" class="btn btn-primary" role="button">Add Delivery</a>
                        </div> <!--// end col-sm-4   delivery button  -->
                    {% endif%}
                </div> <!--// end panel body -->
            </div> <!--// end panel -->
        </div> <!--// end col-sm-5  Actions  allowed  -->
    </div> <!--// end row -->

    <div class="row row-space-2 margin-b-4">
        <div class="col-sm-12">
            <div class="tab">
                    <button class="tablinks" onclick="summaryBin(event, 'request_services')"  id="defaultOpen">Requested Services</button>
                    <button class="tablinks" onclick="summaryBin(event, 'pipelines')">Pipelines</button>
                    <button class="tablinks" onclick="summaryBin(event, 'resolutions')">Resolutions</button>
                    <button class="tablinks" onclick="summaryBin(event, 'deliveries')">Deliveries</button>
            </div> <!--  end tabs -->
        <div class="col-sm-12">  <!-- Resolution and Delivery Information from service -->
            <div id="request_services" class="tabcontent">
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        <div class="panel-heading"><h3>Requested Services</h3></div>
                        <div class="panel-body">
                            <ul class="root">
                                {% recursetree display_service.nodes %}
                                    <li>
                                        {{ node }}
                                        {% if not node.is_leaf_node %}
                                            <ul class="children">
                                                {{ children }}
                                            </ul>
                                            <BR>
                                        {% endif %}
                                    </li>
                                {% endrecursetree %}
                            </ul>
                        </div> <!--// end panel body -->
                    </div> <!--// end panel -->
                </div> <!--// end col-sm-6 -->
                <div class="col-sm-5 col-sm-offset-1">
                    <div class="col-sm-12">  <!-- Projects Requested services -->
                        <div class="panel panel-default">
                            <div class="panel-heading"><h3>Samples requested in service</h3></div>
                            <div class="panel-body">
                                <table class="table table-hover">
                                    <tbody>
                                        {% for key, value in display_service.samples %}
                                            <tr>
                                                <td><a href="/wetlab/displaySampleInRun={{ key }}"  target="_blank" rel="noopener noreferrer">{{value}}</a> </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div> <!--// end panel body -->
                        </div> <!--// end panel -->
                    </div> <!--// end col-sm-12   Requested services  -->
                    <div class="col-sm-12">  <!-- Notes in the Requested services -->
                        <div class="panel panel-default">
                            <div class="panel-heading"><h3>Notes included in the service request</h3></div>
                            <div class="panel-body">
                                {{display_service.service_notes}}
                            </div> <!--// end panel body -->
                        </div> <!--// end panel -->
                    </div> <!--// end col-sm-12  Projects Requested services  -->
                </div> <!--// end col-sm-5 -->
            </div><!-- // end of tab request_services -->

            <div id="pipelines" class="tabcontent">
                <div class="col-sm-6">
                    <div class="panel panel-default">
                        <div class="panel-heading"><h3>Pipelines used in Services</h3></div>
                        <div class="panel-body">
                            {% if display_service.pipelines %}
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            {% for value in display_service.pipelines.heading %}
                                                <th>{{value}}</th>
                                            {% endfor %}
                                       </tr>
                                    </thead>
                                    <tbody>
                                        {% for name, version, service in display_service.pipelines.services %}
                                            <tr>
                                                <td>{{service}}</td>
                                                <td>{{name}}</td>
                                                <td>{{version}}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            {% else %}
                                <h5 style="text-align:center"> There are no pipelines used for the requested service</h5>
                            {% endif %}
                        </div> <!--// end panel body -->
                    </div> <!--// end panel -->
                </div> <!--// end col-sm-12  Projects Requested services  -->
            </div> <!--// end col-sm-5 -->
        </div><!-- // end of tab pipelines -->

            <div id="resolutions" class="tabcontent">
                <div class="col-sm-6">  <!-- Resolution information from service -->
                    <div class="panel panel-default">
                        <div class="panel-heading"><h3>Resolution requested information</h3></div>
                        <div class="panel-body">
                            {% if display_service.resolutions %}
                                {% for resolutions  in display_service.resolutions %}
                                    {% for resolution_number, folder_name, assigned_to, estimate_date, queued_date, inprog_date, notes in resolutions %}
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th colspan= "2">Resolution information for {{ resolution_number }}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Folder name:  </td>
                                                    <td> {{ folder_name }} </td>
                                                </tr>
                                                <tr>
                                                    <td>Service assigned to:  </td>
                                                    <td> {{ assigned_to }} </td>
                                                </tr>
                                                <tr>
                                                    <td>Estimated Delivery Date:  </td>
                                                    <td> {{ estimate_date }} </td>
                                                </tr>
                                                <tr>
                                                    <td>Queued Date:  </td>
                                                    <td> {{ queued_date }} </td>
                                                </tr>
                                                <tr>
                                                    <td>In Progress Date: </td>
                                                    <td>{{ inprog_date }}</td>
                                                </tr>
                                                <tr>
                                                    <td>Notes: </td>
                                                    <td>{{ notes }}</td>
                                                </tr>
                                           </tbody>
                                        </table>
                                    {% endfor %}
                                    <BR><BR>
                                {% endfor %}
                            {% endif %}
                        </div> <!--// end panel body -->
                    </div> <!--// end panel -->
                </div> <!--// end col-sm-7  Resolution information from service  -->
            </div><!-- // end of tab resolutions -->
            <div id="deliveries" class="tabcontent">
                <div class="col-sm-6">  <!-- Resolution information from service -->
                    <div class="panel panel-default">
                        <div class="panel-heading"><h3>Delivery information</h3></div>
                        <div class="panel-body">
                            {% if display_service.delivery %}
                                {% for delivery  in display_service.delivery %}
                                    {% for  resolution_number, delivery_date, notes in delivery %}
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th colspan= "2">Delivery information  for Resolution {{ resolution_number }}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Delivery Date:  </td>
                                                    <td> {{ delivery_date }} </td>
                                                </tr>
                                                <tr>
                                                    <td>Notes: </td>
                                                    <td>{{ notes }}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    {% endfor %}
                                    <BR><BR>
                                {% endfor %}
                            {% endif %}
                        </div> <!--// end panel body -->
                    </div> <!--// end panel -->
                </div> <!--// end col-sm-6  Deliveries information from service  -->
            </div><!-- // end of tab deliveries -->
        </div> <!--// end sm 12 -->
    </div>   <!--// end row -->
    <script>
        // Get the element with id="defaultOpen" and click on it
        document.getElementById("defaultOpen").click();
    </script>
{% endif %}
{% endblock %}
